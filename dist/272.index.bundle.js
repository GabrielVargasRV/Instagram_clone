(self.webpackChunkwhatsappv2=self.webpackChunkwhatsappv2||[]).push([[272],{3272:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var r=n(6156),a=n(2137),c=n(4699),s=n(7757),l=n.n(s),o=n(7294),u=n(4494),i=n(4593),m=n(5977),f=n(3727),p=n(2051),d=n(96);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const v=(0,u.$j)((function(e){return{userData:e.userData}}),(function(e){return{}}))((function(e){var t=e.userData,n=(0,m.UO)().id,r=(0,o.useRef)(),s=(0,o.useState)([]),u=(0,c.Z)(s,2),h=u[0],v=u[1],g=(0,o.useState)(null),b=(0,c.Z)(g,2),y=b[0],w=b[1],x=(0,o.useState)([]),O=(0,c.Z)(x,2),j=O[0],D=O[1],S=(0,o.useState)(""),N=(0,c.Z)(S,2),k=N[0],P=N[1],Z=(0,o.useState)(!0),M=(0,c.Z)(Z,2),I=M[0],C=M[1],U=function(){var e=(0,a.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.db.collection("chats").where("usersname","array-contains",t.username).orderBy("lastMsgDate","desc").onSnapshot((function(e){var n=[];e.docs.forEach((function(e){e.data().users.forEach((function(r){r.username!==t.username&&n.push(E(E({},e.data()),{},{id:e.id,profilePhoto:r.photoURL,username:r.username}))}))})),v(n),r.current&&r.current.scrollIntoView({behavior:"smooth"}),C(!1)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,a.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.db.collection("chats").doc(n).get();case 2:return e.sent.data().users.forEach((function(e){e.username!==t.username&&w(e)})),e.next=6,p.db.collection("chats").doc(n).collection("messeges").orderBy("createdAt","asc").onSnapshot((function(e){var t=[];e.docs.forEach((function(e){t.push(E({id:e.id},e.data()))})),D(t),r.current&&r.current.scrollIntoView({behavior:"smooth"})}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,a.Z)(l().mark((function e(a){var c,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),!k.length){e.next=10;break}return c=Date.now(),s={text:k,createdAt:c,username:t.username},e.next=6,p.db.collection("chats").doc(n).collection("messeges").add(s);case 6:return P(""),e.next=9,p.db.collection("chats").doc(n).update({lastMsg:s,lastMsgDate:c});case 9:r.current.scrollIntoView({behavior:"smooth"});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){n&&R(),U()}),[n]),I?o.createElement(d.Z,null):o.createElement("div",{className:"Inbox"},o.createElement(i.q,null,o.createElement("title",null,"Instagram - Inbox")),o.createElement("div",{className:"chats"},o.createElement("div",{className:"chats-header"},o.createElement("p",null,t.username),o.createElement("button",null,o.createElement("i",{class:"fas fa-chevron-down"}))),o.createElement("div",{className:"chats-container"},h.length?o.createElement("div",null,h.map((function(e){return o.createElement(f.rU,{to:"/inbox/".concat(e.id),className:"chats-item link"},o.createElement("img",{src:e.profilePhoto,alt:""}),o.createElement("div",null,o.createElement("p",null,e.username),o.createElement("p",{style:{opacity:"60%"}},e.lastMsg?e.lastMsg.text.length>25?"".concat(e.lastMsg.text.substr(0,25),"..."):e.lastMsg.text:"")))}))):o.createElement("div",null))),o.createElement("div",null,n?y?o.createElement("div",{className:"chat"},o.createElement("div",{className:"chat-header"},o.createElement("img",{src:y.photoURL,alt:""}),o.createElement("p",null,y.username)),o.createElement("div",{className:"chat-body"},o.createElement("div",{className:"messeges-container"},j.map((function(e){return o.createElement("p",{className:e.username===t.username?"my-msg":"msg"},e.text)})),o.createElement("div",{ref:r})),o.createElement("div",{className:"messege-form"},o.createElement("form",{onSubmit:V},o.createElement("textarea",{name:"",cols:"30",placeholder:"Messege...",value:k,onChange:function(e){return P(e.target.value)}}),o.createElement("button",{type:"submit"},"Send"))))):o.createElement("div",null,"loading..."):o.createElement("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},o.createElement("i",{class:"fas fa-paper-plane",style:{transform:"scale(3)",margin:"20px"}}),o.createElement("p",{style:{fontSize:"24px",fontWeight:"100"}},"Your Messeges"))))}))}}]);